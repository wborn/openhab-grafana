"use strict";var OHG_DEFAULTS={debug:"false",render:"false",refresh:"0",sitemap:"default",urlPrefix:"http://grafana:3000",panelPath:"/d-solo/",renderPanelPath:"/render/d-solo/",from:"now-1d",to:"now",theme:"light",width:"auto",height:"auto"};function queryParams(e){if(!e)return{};for(var t,r=e.toString(),a=r.indexOf("?"),n=-1!==a?r.substring(a+1):"",i=/([^&=]+)=?([^&]*)/g,o=function(e){return decodeURIComponent(e.replace(/\+/g," "))},u={};(t=i.exec(n))&&(u[o(t[1])]=o(t[2])),t;);return u}var urlParams=queryParams(window.location),parentUrlParams=queryParams(window.parent.location.href);function resolveParam(e,t){return void 0!==e&&void 0!==e[t]?e[t]:void 0!==urlParams&&void 0!==urlParams[t]?urlParams[t]:void 0!==parentUrlParams&&void 0!==parentUrlParams[t]?parentUrlParams[t]:OHG_DEFAULTS[t]}function OHSubscriber(e){var t=e,r=!1,a=[],o={},i={id:"",page:resolveParam(t,"w"),sitemap:resolveParam(t,"sitemap")};function u(e){var t=e,r=void 0!==t.type?t.type:"GET",a=void 0!==t.data?t.data:"",n=void 0!==t.headers?t.headers:{},i=new XMLHttpRequest;for(var o in i.open(r,t.url,!0),n)i.setRequestHeader(o,n[o]);return i.onload=function(){i.status<200||400<i.status?"function"==typeof t.error&&t.error(i):"function"==typeof t.callback&&t.callback(i)},i.onerror=function(){"function"==typeof t.error&&t.error(i)},i.send(a),i}function n(){var e=[];for(var t in o)void 0===o[t].value&&e.push(t);return e}function s(){if(!r&&0===n().length){r=!0;for(var e=0;e<a.length;e++)a[e]()}}function l(e,t){if(o[e].value!==t){o[e].value=t;for(var r=o[e].listeners,a=0;a<r.length;a++){(0,r[a])(e,t)}s()}}function m(){var r=this;!function t(){var e=Math.random().toString(16).slice(2);r.request=u({url:"/rest/sitemaps/"+i.sitemap+"/"+i.page+"?_="+e,headers:{"X-Atmosphere-Transport":"long-polling"},callback:function(e){!function(e){try{e=JSON.parse(e)}catch(e){return}function t(e){e.forEach(function(e){if(void 0!==e.item){var t=e.item.name,r=e.item.state;void 0!==o[t]&&l(t,r)}})}e.leaf?t(e.widgets):e.widgets.forEach(function(e){t(e.widgets)})}(e.responseText),setTimeout(function(){t()},1)},error:function(){setTimeout(function(){t()},1e3)}})}()}function d(){var n=this;n.startSubscriber=function(e){var t,r,a;try{t=JSON.parse(e.responseText)}catch(e){return}if("CREATED"===t.status){try{r=t.context.headers.Location[0]}catch(e){return}a=r.split("/"),i.id=a[a.length-1],"EventSource"in window?function(e){var i=this;i.navigate=function(){},i.source=new EventSource(e),i.source.addEventListener("event",function(e){if(!i.paused){var t,r=JSON.parse(e.data),a=r.item.name;if(void 0!==o[a]){if("string"==typeof r.label&&-1!==r.label.indexOf("[")&&-1!==r.label.indexOf("]")){var n=r.label.indexOf("[");t=r.label.substr(n+1,r.label.lastIndexOf("]")-(n+1))}else t=r.item.state;l(a,t)}}})}.call(n,r+"?sitemap="+i.sitemap+"&pageid="+i.page):m.call(n)}},u({url:"/rest/sitemaps/events/subscribe",type:"POST",callback:n.startSubscriber})}function c(){this.valueHandler=function(e){var t;try{t=JSON.parse(e.responseText)}catch(e){return}l(t.name,t.state)};for(var e=n(),t=0;t<e.length;t++)u({url:"/rest/items/"+e[t],type:"GET",callback:this.valueHandler});s()}this.addItemListener=function(e,t){if("function"!=typeof t)throw new Error("addItemListener 'listener' is not a function");void 0!==o[e]?o[e].listeners.includes(t)||o[e].listeners.push(t):o[e]={listeners:[t],value:void 0}},this.addInitializedListener=function(e){if("function"!=typeof e)throw new Error("addInitializedListener 'listener' is not a function");a.push(e)},this.isInitialized=function(){return r},void 0===i.page&&(i.page=i.sitemap),document.addEventListener("DOMContentLoaded",function(){i.valuesInitializer=new c,i.changeListener=new d})}var ohSubscriber=new OHSubscriber;function GrafanaPanel(e){var t=e,d=void 0,r=void 0,c=resolveParam(t,"frame"),v=resolveParam(t,"urlPrefix"),f=resolveParam(t,"panelPath"),h=resolveParam(t,"renderPanelPath"),p={debug:{value:resolveParam(t,"debug"),itemName:resolveParam(t,"debugItem"),itemFunction:e.debugItemFunction},render:{value:resolveParam(t,"render"),itemName:resolveParam(t,"renderItem"),itemFunction:e.renderItemFunction},refresh:{value:resolveParam(t,"refresh"),itemName:resolveParam(t,"refreshItem"),itemFunction:e.refreshItemFunction}},P={dashboard:{value:resolveParam(t,"dashboard"),itemName:resolveParam(t,"dashboardItem"),itemFunction:e.dashboardItemFunction},from:{key:"from",value:resolveParam(t,"from"),itemName:resolveParam(t,"fromItem"),itemFunction:e.fromItemFunction},to:{key:"to",value:resolveParam(t,"to"),itemName:resolveParam(t,"toItem"),itemFunction:e.toItemFunction},panel:{key:"panelId",value:resolveParam(t,"panel"),itemName:resolveParam(t,"panelItem"),itemFunction:e.panelItemFunction},theme:{key:"theme",value:resolveParam(t,"theme"),itemName:resolveParam(t,"themeItem"),itemFunction:e.themeItemFunction},width:{key:"width",value:resolveParam(t,"width"),itemName:resolveParam(t,"widthItem"),itemFunction:e.widthItemFunction},height:{key:"height",value:resolveParam(t,"height"),itemName:resolveParam(t,"heightItem"),itemFunction:e.heightItemFunction}};function g(){var e=p.debug.value,t=p.render.value,r=p.refresh.value,a=document.getElementById(c),n=a.contentWindow.document,i=v;i+="true"===t?h:f,i+=P.dashboard.value;var o=!0;for(var u in P){var s=P[u].key,l=P[u].value;"width"===s?l="false"===t?void 0:"auto"===l?n.body.clientWidth:l:"height"===s&&(l="false"===t?void 0:"auto"===l?n.body.clientHeight:l),void 0!==s&&void 0!==l&&(i+=(o?"?":"&")+s+"="+l,o=!1)}if("true"===t&&(i+="&cacheBuster="+Date.now()),"true"===e)n.open(),n.write('<a href="'+i+'">'+i+"</a>"),n.close();else if("true"===t){var m=i.replace(h,f);n.open(),n.write("<style>body{margin:0px}p{margin:0px}</style>"),n.write('<p style="text-align:center;"><a href="'+m+'"><img src="'+i+'"></a></p>'),n.close()}else document.getElementById(c).src!==i&&a.contentWindow.location.replace(i);"true"===t&&0<r?(clearTimeout(d),d=setTimeout(g,r)):void 0!==d&&clearTimeout(d)}function a(){"true"!==p.render.value||"auto"!==P.width.value&&"auto"!==P.height.value?clearTimeout(r):(clearTimeout(r),r=setTimeout(g,500))}function n(e,t,r){for(var a in e)void 0!==e[a].itemName&&e[a].itemName===t&&(e[a].itemFunction&&(r=e[a].itemFunction(r)),e[a].value=r)}function i(e,t){n(p,e,t),n(P,e,t),ohSubscriber.isInitialized()&&g()}function o(e,t){if(void 0===t)throw new Error("Property '"+e+"' is undefined")}function u(e){for(var t in e){var r=e[t].itemName;if(void 0!==r)ohSubscriber.addItemListener(r,i);else if(void 0===e[t].value)throw new Error("Property '"+t+"' requires a default value or itemName to obtain the value from")}}o("frame",c),o("urlPrefix",v),o("panelPath",f),o("renderPanelPath",h),u(p),u(P),ohSubscriber.addInitializedListener(g),window.addEventListener("resize",a)}var grafanaPanels=[];function createGuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function addGrafanaPanel(e,t){void 0===e&&(e=createGuid());var r=document.createElement("div");r.id="panel-"+e+"-container",r.className="panel-container",document.body.appendChild(r);var a=document.createElement("iframe");a.id="panel-"+e+"-frame",a.className="panel-frame",a.scrolling="no",r.appendChild(a),void 0===t&&(t={}),t.frame=a.id;var n=new GrafanaPanel(t);grafanaPanels.push(n)}