"use strict";function queryParams(a){if(!a)return{};var b,c=a.toString(),d=c.indexOf("?"),e=d!==-1?c.substring(d+1):"",f=/([^&=]+)=?([^&]*)/g,g=function(a){return decodeURIComponent(a.replace(/\+/g," "))},h={};do b=f.exec(e),b&&(h[g(b[1])]=g(b[2]));while(b);return h}function resolveParam(a,b){return void 0!==a&&void 0!==a[b]?a[b]:void 0!==urlParams&&void 0!==urlParams[b]?urlParams[b]:void 0!==parentUrlParams&&void 0!==parentUrlParams[b]?parentUrlParams[b]:SMARTHOME_GRAFANA_DEFAULTS[b]}function SmartHomeSubscriber(a){function b(a){var b=a,c="undefined"!=typeof b.type?b.type:"GET",d="undefined"!=typeof b.data?b.data:"",e="undefined"!=typeof b.headers?b.headers:{},f=new XMLHttpRequest;f.open(c,b.url,!0);for(var g in e)f.setRequestHeader(g,e[g]);return f.onload=function(){return f.status<200||f.status>400?void("function"==typeof b.error&&b.error(f)):void("function"==typeof b.callback&&b.callback(f))},f.onerror=function(){"function"==typeof b.error&&b.error(f)},f.send(d),f}function c(){var a=[];for(var b in n)void 0===n[b].value&&a.push(b);return a}function d(){return 0===c().length}function e(){if(!l&&d()){l=!0;for(var a=0;a<m.length;a++)m[a]()}}function f(a,b){if(n[a].value!==b){n[a].value=b;for(var c=n[a].listeners,d=0;d<c.length;d++){var f=c[d];f(a,b)}e()}}function g(a){var b=this;b.navigate=function(){},b.source=new EventSource(a),b.source.addEventListener("event",function(a){if(!b.paused){var c,d=JSON.parse(a.data),e=d.item.name;if(void 0!==n[e]){if("string"==typeof d.label&&d.label.indexOf("[")!==-1&&d.label.indexOf("]")!==-1){var g=d.label.indexOf("[");c=d.label.substr(g+1,d.label.lastIndexOf("]")-(g+1))}else c=d.item.state;f(e,c)}}})}function h(){var a=this;a.startSubscriber=function(b){var c,d,e;try{c=JSON.parse(b.responseText)}catch(f){return}if("CREATED"===c.status){try{d=c.context.headers.Location[0]}catch(f){return}e=d.split("/"),o.id=e[e.length-1],g.call(a,d+"?sitemap="+o.sitemap+"&pageid="+o.page)}},b({url:"/rest/sitemaps/events/subscribe",type:"POST",callback:a.startSubscriber})}function i(){var a=this;a.valueHandler=function(a){var b;try{b=JSON.parse(a.responseText)}catch(c){return}f(b.name,b.state)};for(var d=c(),g=0;g<d.length;g++)b({url:"/rest/items/"+d[g],type:"GET",callback:a.valueHandler});e()}function j(){void 0===o.page&&(o.page=o.sitemap),document.addEventListener("DOMContentLoaded",function(){o.valuesInitializer=new i,o.changeListener=new h})}var k=a,l=!1,m=[],n={},o={id:"",page:resolveParam(k,"w"),sitemap:resolveParam(k,"sitemap")};this.addItemListener=function(a,b){if("function"!=typeof b)throw new Error("addItemListener 'listener' is not a function");void 0!==n[a]?n[a].listeners.push(b):n[a]={listeners:[b],value:void 0}},this.addInitializedListener=function(a){if("function"!=typeof a)throw new Error("addInitializedListener 'listener' is not a function");m.push(a)},this.isInitialized=function(){return l},j()}function GrafanaPanel(a){function b(){var a=n.debug.value,c=n.render.value,d=n.refresh.value,e=document.getElementById(i),f=e.contentWindow.document,g=j;g+="true"===c?l:k,g+=o.dashboard.value;var h=!0;for(var p in o){var q=o[p].key,r=o[p].value;"width"===q?r="false"===c?void 0:"auto"===r?f.body.clientWidth:r:"height"===q&&(r="false"===c?void 0:"auto"===r?f.body.clientHeight:r),void 0!==q&&void 0!==r&&(g+=(h?"?":"&")+q+"="+r,h=!1)}if("true"===c&&(g+="&cacheBuster="+Date.now()),"true"===a)f.open(),f.write('<a href="'+g+'">'+g+"</a>"),f.close();else if("true"===c){var s=g.replace(l,k);f.open(),f.write("<style>body{margin:0px}p{margin:0px}</style>"),f.write('<p style="text-align:center;"><a href="'+s+'"><img src="'+g+'"></a></p>'),f.close()}else document.getElementById(i).src!==g&&e.contentWindow.location.replace(g);"true"===c&&d>0?(void 0!==m&&clearTimeout(m),m=setTimeout(b,d)):void 0!==m&&(clearTimeout(m),m=void 0),"true"!==c||"auto"!==o.width.value&&"auto"!==o.height.value?f.body.onresize=void 0:f.body.onresize=b}function c(a,b,c){for(var d in a)void 0!==a[d].itemName&&a[d].itemName===b&&(a[d].itemFunction&&(c=a[d].itemFunction(c)),a[d].value=c)}function d(a,d){c(n,a,d),c(o,a,d),smartHomeSubscriber.isInitialized()&&b()}function e(a,b){if(void 0===b)throw new Error("Property '"+a+"' is undefined")}function f(a){for(var b in a){var c=a[b].itemName;if(void 0!==c)smartHomeSubscriber.addItemListener(c,d);else if(void 0===a[b].value)throw new Error("Property '"+b+"' requires a default value or itemName to obtain the value from")}}function g(){e("frame",i),e("urlPrefix",j),e("panelPath",k),e("renderPanelPath",l),f(n),f(o),smartHomeSubscriber.addInitializedListener(b)}var h=a,i=resolveParam(h,"frame"),j=resolveParam(h,"urlPrefix"),k=resolveParam(h,"panelPath"),l=resolveParam(h,"renderPanelPath"),m=void 0,n={debug:{value:resolveParam(h,"debug"),itemName:resolveParam(h,"debugItem"),itemFunction:a.debugItemFunction},render:{value:resolveParam(h,"render"),itemName:resolveParam(h,"renderItem"),itemFunction:a.renderItemFunction},refresh:{value:resolveParam(h,"refresh"),itemName:resolveParam(h,"refreshItem"),itemFunction:a.refreshItemFunction}},o={dashboard:{value:resolveParam(h,"dashboard"),itemName:resolveParam(h,"dashboardItem"),itemFunction:a.dashboardItemFunction},from:{key:"from",value:resolveParam(h,"from"),itemName:resolveParam(h,"fromItem"),itemFunction:a.fromItemFunction},to:{key:"to",value:resolveParam(h,"to"),itemName:resolveParam(h,"toItem"),itemFunction:a.toItemFunction},panel:{key:"panelId",value:resolveParam(h,"panel"),itemName:resolveParam(h,"panelItem"),itemFunction:a.panelItemFunction},theme:{key:"theme",value:resolveParam(h,"theme"),itemName:resolveParam(h,"themeItem"),itemFunction:a.themeItemFunction},width:{key:"width",value:resolveParam(h,"width"),itemName:resolveParam(h,"widthItem"),itemFunction:a.widthItemFunction},height:{key:"height",value:resolveParam(h,"height"),itemName:resolveParam(h,"heightItem"),itemFunction:a.heightItemFunction}};g()}function createGuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)})}function addGrafanaPanel(a,b){void 0===a&&(a=createGuid());var c=document.createElement("div");c.id="panel-"+a+"-container",c.className="panel-container",document.body.appendChild(c);var d=document.createElement("iframe");d.id="panel-"+a+"-frame",d.className="panel-frame",d.scrolling="no",c.appendChild(d),void 0===b&&(b={}),b.frame=d.id;var e=new GrafanaPanel(b);grafanaPanels.push(e)}var SMARTHOME_GRAFANA_DEFAULTS={debug:"false",render:"false",refresh:"0",sitemap:"default",urlPrefix:"http://grafana:3000",panelPath:"/dashboard-solo/db/",renderPanelPath:"/render/dashboard-solo/db/",from:"now-1d",to:"now",theme:"light",width:"auto",height:"auto"},urlParams=queryParams(window.location),parentUrlParams=queryParams(window.parent.location.href),smartHomeSubscriber=new SmartHomeSubscriber,grafanaPanels=[];